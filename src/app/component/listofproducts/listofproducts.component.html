<div class="container py-3">
  <app-searchbar (queryChange)="onQuery($event)"></app-searchbar>
  @if (error) {
    <div class="alert alert-danger d-flex align-items-center" role="alert">
      <div class="me-auto">
        {{error}}
      </div>
      <button type="button" class="btn btn-sm btn-danger" (click)="load()">Intenta de nuevo</button>
    </div>
  }
  @if (loading && !error) {
    <div class="row g-3">
      @for(_ of placeholders; track _; let i =$index){
        <div class="col-12 col-sm-6 col-md-4 col-lg-3">
          <article class="card h-100 shadow-sm" aria-hidden="true">
            <div class="ratio ratio-1x1 bg-light">
              <div class="placeholder w-100 h-100"></div>
            </div>
            <div class="card-body">
              <h3 class="card-title h6">
                <span class="placeholder col-9"></span>
              </h3>
              <p class="small mb-2">
                <span class="placeholder col-5"></span>
              </p>
              <div class="fw-bold">
                <span class="placeholder col-4"></span>
              </div>
            </div>
          </article>
        </div>
      }
    </div>
  }

  @if (!loading && !error) {
    <div class="d-flex flex-wrap gap-2 justify-content-between align-items-center mb-2" >
      <small class="text-muted order-2 order-sm-1">Mostrando {{startIndex+1}}-{{endIndex}} de {{totalItems}} resultado(s)</small>
      <div class="d-flex align-items-center gap-2 order-1 order-sm-2 ms-auto">
        <label class="form-label m-0 me-1" for="pageSizeSel">Por página</label>
        <select id="pageSizeSel" class="form-select form-select-sm w-auto" [ngModel]="pageSize" (ngModelChange)="changePageSize($event)">
          @for (s of pageSizeOptions; track s) {
            <option [ngValue]="s">{{ s }}</option>
          }
        </select>
      </div>
    </div>

    <div class="row g-3">
      @for (p of visible; track p.id){
        <div class="col-12 col-sm-6 col-md-4 col-lg-3">
          <app-product-cards [product]="p"></app-product-cards>
        </div>
      }
    </div>

<!--Controles de paginación-->
    <nav class="mt-3" aria-label="Paginación de productos">
      <ul class="pagination pagination-sm mb-0">
        <li class="page-item" [class.disabled]="page === 1">
          <button class="page-link" (click)="prev()" [disabled]="page === 1" aria-label="Anterior">&laquo;</button>
        </li>

        <!--Mostart un pequeño rango de paginas alrededor de la página actual-->
        @for (pg of [].constructor(totalPages); let i =$index; track i){
          @if (i +1 >= page - 2 && i + 1 <= page +2 || i === 0 || i + 1 === totalPages) {
            <li class="page-item" [class.active]= "i + 1 === page">
              <button class="page-link" (click)="goTo(i + 1)">{{i + 1 }}</button>
            </li>
          }
        }
        <li class="page-item" [class.disable]="page === totalPages">
          <button class="page-link" (click)="next()" [disabled]="page === totalPages" aria-label="Siguiente">&raquo;</button>
        </li>
      </ul>
    </nav>

    @if (products.length === 0) {
      <div class="alert alert-info mt-3" role="status">No hay resultados</div>
    }
  }
</div>
